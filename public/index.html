<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JARVIS AI</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="particles"></div>

<div class="container">
  <h1 class="title">J A R V I S</h1>
  <p class="sub">Fully Trained by <span>SAHAL_PRO</span></p>

  <div id="chat-box" class="chat-box"></div>

  <div class="input-area">
    <input id="userInput" type="text" placeholder="Type your message..." autocomplete="off">
    <button id="sendBtn">Send</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/tsparticles@2/tsparticles.bundle.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  tsParticles.load("particles", {
    background: { color: "#000" },
    fpsLimit: 60,
    particles: {
      number: { value: 120 },
      color: { value: ["#00eaff","#00ffaa"] },
      shape: { type: "circle" },
      opacity: { value: 0.6 },
      size: { value: { min: 2, max: 4 } },
      move: { enable: true, speed: 1.5, direction: "none", outModes: "bounce" },
      links: { enable: true, distance: 120, color: "#00ffaa", opacity: 0.4, width: 1 }
    },
    interactivity: {
      events: { 
        onHover: { enable: true, mode: "repulse" }, 
        onClick: { enable: true, mode: "push" } 
      },
      modes: { repulse: { distance: 100 }, push: { quantity: 4 } }
    },
    detectRetina: true
  });
});

const chatBox = document.getElementById("chat-box");
const input = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");

sendBtn.onclick = sendMessage;
input.addEventListener("keydown", e => { if(e.key==="Enter") sendMessage(); });

function addMessage(sender, text, gifUrl=null){
  const bubble = document.createElement("div");
  bubble.classList.add("message", sender==="You"?"user":"ai");

  const textEl = document.createElement("div");
  textEl.textContent = text;
  bubble.appendChild(textEl);

  if(gifUrl){
    const img = document.createElement("img");
    img.src = gifUrl;
    bubble.appendChild(img);
  }

  chatBox.appendChild(bubble);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMessage(){
  const message = input.value.trim();
  if(!message) return;
  addMessage("You", message);
  input.value="";

  // Typing effect placeholder
  const typingBubble = document.createElement("div");
  typingBubble.classList.add("typing");
  typingBubble.textContent = "JARVIS is typing";
  chatBox.appendChild(typingBubble);
  chatBox.scrollTop = chatBox.scrollHeight;

  try{
    const res = await fetch("/ask", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({message})
    });
    const data = await res.json();
    chatBox.removeChild(typingBubble);
    addMessage("JARVIS", data.reply, data.gif);
  }catch(err){
    chatBox.removeChild(typingBubble);
    addMessage("JARVIS","⚠️ Error sending request.");
  }
}
</script>

</body>
</html>
